<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>BET300 ¬∑ Registro</title>
<meta name="theme-color" content="#0b1020"/>
<style>
  :root{
    --bg:#0b1020; --panel:#111735; --panel2:#0d1330; --border:#212a57;
    --text:#e9ecff; --muted:#aab0d6; --ok:#25D366;
    --brand:#f0c86a; /* mostaza del logo */
    --brand2:#f7d887;
    --accent:#7c59ff; --cyan:#22d3ee;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.35 system-ui,-apple-system,Segoe UI,Roboto}
  body::before{
    content:"";position:fixed;inset:0;z-index:-1;
    background:
      radial-gradient(900px 500px at 85% -10%, rgba(124,77,255,.18), transparent),
      radial-gradient(700px 350px at 0% 0%, rgba(0,209,255,.12), transparent),
      linear-gradient(180deg,#0b1020 0%,#0b1020 60%,#0a0f1f 100%);
  }

  .wrap{max-width:820px;margin:24px auto;padding:0 14px}
  .card{background:var(--panel2);border:1px solid var(--border);border-radius:18px;box-shadow:0 16px 40px rgba(0,0,0,.35);padding:18px}
  .head{display:flex;align-items:center;justify-content:center;margin-bottom:8px}
  .logo{height:54px;display:block}
  h1{margin:8px 0 6px;text-align:center;font-size:24px}
  .note{color:var(--muted);text-align:center;font-size:14px;margin-bottom:14px}
  .pill{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--border);background:linear-gradient(90deg,rgba(124,89,255,.12),rgba(34,211,238,.12));padding:6px 10px;border-radius:999px;font-size:12px}

  .form{display:grid;gap:12px;margin-top:10px}
  label{font-size:13px;color:var(--muted)}
  .input{
    width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--border);
    background:var(--panel);color:var(--text);outline:none
  }
  .row{display:grid;gap:12px}
  @media(min-width:640px){ .row{grid-template-columns:1fr 1fr} }

  .btn{
    appearance:none;border:none;cursor:pointer;width:100%;
    padding:13px 16px;border-radius:14px;font-weight:900;letter-spacing:.3px;
    color:#0a0f1f;box-shadow:0 10px 24px rgba(0,0,0,.35)
  }
  .btn.primary{
    background:linear-gradient(90deg,var(--brand),var(--brand2));
    border:1px solid rgba(255,255,255,.06)
  }
  .btn.ghost{
    background:transparent;color:var(--text);border:1px solid var(--border)
  }
  .btn.ok{background:var(--ok);color:#0b0f1e}

  .actions{display:grid;gap:10px;margin-top:8px}
  @media(min-width:640px){ .actions{grid-template-columns:1fr 1fr 1fr} }

  .hint{font-size:12px;color:var(--muted);margin-top:6px;text-align:center}
  .error{color:#ff7a7a;font-size:13px}

  .footer{margin-top:14px;display:flex;justify-content:center}
  .tiny{font-size:12px;color:var(--muted);text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="head">
      <!-- Pon√© tu imagen si quer√©s: <img class="logo" src="./logo-bet300.png" alt="BET300"> -->
      <svg class="logo" viewBox="0 0 420 120" aria-label="BET300">
        <defs>
          <linearGradient id="g" x1="0" x2="0" y1="0" y2="1">
            <stop stop-color="#fff3ce"/>
            <stop offset="1" stop-color="#f0c86a"/>
          </linearGradient>
        </defs>
        <text x="0" y="82" font-size="88" font-family="system-ui,Segoe UI,Roboto" fill="white" font-weight="900">BET</text>
        <text x="180" y="82" font-size="88" font-family="system-ui,Segoe UI,Roboto" fill="url(#g)" font-weight="900">300</text>
      </svg>
    </div>
    <h1>Registrate para ingresar</h1>
    <p class="note">
      <span class="pill">üîí Autogesti√≥n disponible</span>
      &nbsp;‚Ä¢&nbsp; Soporte dentro de la plataforma
      &nbsp;‚Ä¢&nbsp; <b style="color:#bfefff">+30% 1¬™ carga</b>
    </p>

    <form id="regForm" class="form" autocomplete="off">
      <div>
        <label for="user">Usuario</label>
        <input id="user" class="input" type="text" name="user" minlength="3" maxlength="24" placeholder="tu-usuario" required />
      </div>

      <div>
        <label for="pass">Contrase√±a</label>
        <input id="pass" class="input" type="password" name="pass" minlength="4" maxlength="24" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
      </div>

      <div>
        <label for="tel">Tel√©fono (solo n√∫meros)</label>
        <input id="tel" class="input" type="tel" name="tel" pattern="[0-9]{6,14}" inputmode="numeric" placeholder="11xxxxxxxx" required />
      </div>

      <div id="err" class="error" role="alert" style="display:none"></div>

      <div class="actions">
        <button type="submit" class="btn primary">üéÅ Registrarse</button>
        <button id="dlBtn" type="button" class="btn ghost">‚¨áÔ∏è Descargar registros</button>
        <button id="clearBtn" type="button" class="btn ghost">üóëÔ∏è Borrar</button>
      </div>
    </form>

    <p class="hint">Us√° el link con <code>?pc=1</code>, <code>?pc=2</code>, <code>?pc=3</code> o <code>?pc=4</code> para que env√≠e al WhatsApp correcto.</p>
  </div>

  <div class="footer">
    <p class="tiny">BET300 ¬© ‚Äî Si el WhatsApp no abre, te redirigimos autom√°ticamente con un m√©todo alternativo.</p>
  </div>
</div>

<script>
/* ===========================
   1) Configuraci√≥n de destino
   =========================== */
const PC_NUMBERS = {
  1: "1171561685",
  2: "1171561022",
  3: "1134970581",
  4: "1135854862" // PC4 solo slot/ruleta ‚Äî igual lo dejamos para alta
};
// Build E164 for AR: 54 + 9 + 11 + XXXXXXX  (los n√∫meros que pasaste ya empiezan con 11)
function buildAR(number11) {
  // asegura 11 d√≠gitos
  const n = (number11 || "").replace(/\D/g,"");
  // WhatsApp para CABA: 54 9 11 + resto
  return "54911" + n.slice(2);
}
const params = new URLSearchParams(location.search);
const pc = ["1","2","3","4"].includes(params.get("pc")) ? params.get("pc") : "1";
const wpLocal = buildAR(PC_NUMBERS[pc]);

/* ===========================
   2) Utilidades
   =========================== */
function fmtTs(d=new Date()){
  const dd=String(d.getDate()).padStart(2,'0');
  const mm=String(d.getMonth()+1).padStart(2,'0');
  const yyyy=d.getFullYear();
  const hh=String(d.getHours()).padStart(2,'0');
  const mi=String(d.getMinutes()).padStart(2,'0');
  return `${dd}/${mm}/${yyyy} ${hh}:${mi}`;
}
function saveRow(row){
  const arr = JSON.parse(localStorage.getItem("bet300_regs")||"[]");
  arr.push(row);
  localStorage.setItem("bet300_regs", JSON.stringify(arr));
}
function downloadCSV(){
  const arr = JSON.parse(localStorage.getItem("bet300_regs")||"[]");
  if(!arr.length){ alert("No hay registros guardados en este dispositivo."); return; }
  const head = ["timestamp","pc","usuario","telefono","hash"];
  const rows = arr.map(o => [o.ts,o.pc,o.user,o.tel,o.hash]);
  const csv = [head.join(","), ...rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(","))].join("\n");
  const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = `bet300_registros_${Date.now()}.csv`;
  document.body.appendChild(a); a.click(); a.remove();
}
async function sha256hex(msg){
  const enc = new TextEncoder().encode(msg);
  const buf = await crypto.subtle.digest("SHA-256", enc);
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

/* ===========================
   3) Env√≠o a WhatsApp robusto
   =========================== */
function openWhatsApp(phoneE164, text){
  // M√©todo 1 (universal y menos bloqueos)
  const url = `https://api.whatsapp.com/send?phone=${encodeURIComponent(phoneE164)}&text=${encodeURIComponent(text)}`;
  // Forzar navegaci√≥n (sin window.open)
  location.href = url;
}

/* ===========================
   4) Manejadores UI
   =========================== */
const f = document.getElementById("regForm");
const err = document.getElementById("err");
document.getElementById("dlBtn").onclick = downloadCSV;
document.getElementById("clearBtn").onclick = () => {
  if(confirm("¬øBorrar registros locales?")) localStorage.removeItem("bet300_regs");
};

f.addEventListener("submit", async (e)=>{
  e.preventDefault();
  err.style.display="none"; err.textContent="";

  const user = document.getElementById("user").value.trim();
  const pass = document.getElementById("pass").value.trim();
  const tel  = document.getElementById("tel").value.replace(/\D/g,"");

  // Validaciones simples
  if(user.length<3){ err.textContent="El usuario debe tener al menos 3 caracteres."; err.style.display="block"; return; }
  if(pass.length<4){ err.textContent="La contrase√±a debe tener al menos 4 caracteres."; err.style.display="block"; return; }
  if(tel.length<6){ err.textContent="Ingres√° un tel√©fono v√°lido (solo n√∫meros)."; err.style.display="block"; return; }

  // Hash para control (se lo pasamos al operador en el mensaje)
  const ts = fmtTs();
  const hash = (await sha256hex(`${user}|${tel}|${pc}|${ts}`)).slice(0,10).toUpperCase();

  // Guardar local (por si el user vuelve)
  saveRow({ ts, pc, user, tel, hash });

  const texto =
`Hola üëã, quiero crear usuario en la plataforma.
‚Ä¢ PC: ${pc}
‚Ä¢ Usuario: ${user}
‚Ä¢ Tel√©fono: ${tel}
‚Ä¢ Hash: ${hash}
‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
Una vez creado, por favor enviame el link de acceso.`;

  // Abrir WhatsApp SIEMPRE (sin popups)
  openWhatsApp(wpLocal, texto);

  // Feedback m√≠nimo
  // (si el navegador tarda en abrir WA, al menos el bot√≥n no ‚Äúqueda colgado‚Äù)
  const btn = f.querySelector('.btn.primary');
  btn.disabled = true; btn.textContent = "Abriendo WhatsApp‚Ä¶";
  setTimeout(()=>{ btn.disabled = false; btn.textContent = "üéÅ Registrarse"; }, 3500);
});
</script>
</body>
</html>
